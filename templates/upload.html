<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>엑셀 업로드 평가</title>
    <style>
        body { font-family: sans-serif; margin: 2em; }
        label, input, button { font-size: 1rem; margin: 0.5em 0; }
    </style>
</head>
<body>
    <h2>📤 엑셀 파일 업로드 후 평가</h2>
    <form id="uploadForm">
        <label for="excelFile">엑셀 파일 (.xlsx):</label><br>
        <input type="file" id="excelFile" name="file" accept=".xlsx" required><br>
        <button type="submit">업로드 및 평가</button>
    </form>
    <div id="result"></div>
    <div id="summaryTable" style="margin-top: 2em;"></div>

    <script>
        const form = document.getElementById('uploadForm');
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const fileInput = document.getElementById('excelFile');
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            const res = await fetch('/api/upload_excel', {
                method: 'POST',
                body: formData
            });

            const result = await res.json();
            const output = document.getElementById('result');
            output.innerHTML = '<h3>✅ 평가 결과 요약</h3><pre>' + JSON.stringify(result, null, 2) + '</pre>';

            if (result.summary && Array.isArray(result.summary)) {
                const table = document.createElement('table');
                table.style.borderCollapse = 'collapse';
                table.style.marginTop = '1em';

                const headers = ['Category', 'Score', 'Questions'];
                const thead = document.createElement('thead');
                const headRow = document.createElement('tr');
                headers.forEach(h => {
                    const th = document.createElement('th');
                    th.textContent = h;
                    th.style.border = '1px solid black';
                    th.style.padding = '0.5em';
                    th.style.background = '#f0f0f0';
                    headRow.appendChild(th);
                });
                thead.appendChild(headRow);
                table.appendChild(thead);

                const tbody = document.createElement('tbody');
                result.summary.forEach(row => {
                    const tr = document.createElement('tr');
                    row.forEach(cell => {
                        const td = document.createElement('td');
                        td.textContent = cell;
                        td.style.border = '1px solid black';
                        td.style.padding = '0.5em';
                        tr.appendChild(td);
                    });
                    tbody.appendChild(tr);
                });
                table.appendChild(tbody);

                document.getElementById('summaryTable').appendChild(table);
            }

            if (result.evaluations && Array.isArray(result.evaluations)) {
                const detailedOutput = document.createElement('div');
                detailedOutput.innerHTML = '<h3>📋 평가 세부 결과</h3>';

                const table = document.createElement('table');
                table.style.borderCollapse = 'collapse';
                table.style.marginTop = '1em';

                const headers = ['Category', 'Question', 'Score', 'Answer'];
                const thead = document.createElement('thead');
                const headRow = document.createElement('tr');
                headers.forEach(h => {
                    const th = document.createElement('th');
                    th.textContent = h;
                    th.style.border = '1px solid black';
                    th.style.padding = '0.5em';
                    th.style.background = '#f9f9f9';
                    headRow.appendChild(th);
                });
                thead.appendChild(headRow);
                table.appendChild(thead);

                const tbody = document.createElement('tbody');
                result.evaluations.forEach(row => {
                    const tr = document.createElement('tr');
                    [row.category, row.question, row.score, row.answer].forEach(cell => {
                        const td = document.createElement('td');
                        td.textContent = cell;
                        td.style.border = '1px solid black';
                        td.style.padding = '0.5em';
                        tr.appendChild(td);
                    });
                    tbody.appendChild(tr);
                });
                table.appendChild(tbody);
                detailedOutput.appendChild(table);

                document.body.appendChild(detailedOutput);
            }
        });
    </script>
</body>
</html>
