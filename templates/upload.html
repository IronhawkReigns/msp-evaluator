<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>엑셀 업로드 평가</title>
    <style>
        body { font-family: sans-serif; margin: 2em; }
        label, input, button { font-size: 1rem; margin: 0.5em 0; }
    </style>
</head>
<body>
    <h2>📤 엑셀 파일 업로드 후 평가</h2>
    <form id="uploadForm">
        <label for="excelFile">엑셀 파일 (.xlsx):</label><br>
        <input type="file" id="excelFile" name="file" accept=".xlsx" required><br>
        <button type="submit">업로드 및 평가</button>
    </form>
    <div id="summaryTable" style="margin-top: 2em;"></div>

    <script>
        const form = document.getElementById('uploadForm');
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const fileInput = document.getElementById('excelFile');
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            const res = await fetch('/api/upload_excel', {
                method: 'POST',
                body: formData
            });

            const result = await res.json();

            const summaryTableDiv = document.getElementById('summaryTable');
            summaryTableDiv.innerHTML = '';

            if (result.group_summary && Array.isArray(result.group_summary)) {
                const groupTable = document.createElement('table');
                groupTable.style.borderCollapse = 'collapse';
                groupTable.style.marginTop = '2em';

                const groupHeader = document.createElement('thead');
                const groupHeadRow = document.createElement('tr');
                ['Group', 'Score', 'Questions'].forEach(h => {
                    const th = document.createElement('th');
                    th.textContent = h;
                    th.style.border = '1px solid black';
                    th.style.padding = '0.5em';
                    th.style.background = '#dfefff';
                    groupHeadRow.appendChild(th);
                });
                groupHeader.appendChild(groupHeadRow);
                groupTable.appendChild(groupHeader);

                const groupBody = document.createElement('tbody');
                result.group_summary.forEach(group => {
                    const tr = document.createElement('tr');
                    [group.name || '', group.score || '', group.questions || ''].forEach(cell => {
                        const td = document.createElement('td');
                        td.textContent = cell;
                        td.style.border = '1px solid black';
                        td.style.padding = '0.5em';
                        tr.appendChild(td);
                    });
                    groupBody.appendChild(tr);
                });
                groupTable.appendChild(groupBody);

                summaryTableDiv.appendChild(groupTable);
            }

            if (result.evaluations && Array.isArray(result.evaluations)) {
                const detailedTable = document.createElement('table');
                detailedTable.style.borderCollapse = 'collapse';
                detailedTable.style.marginTop = '2em';

                const headers = ['Category', 'Question', 'Score', 'Answer'];
                const thead = document.createElement('thead');
                const headRow = document.createElement('tr');
                headers.forEach(h => {
                    const th = document.createElement('th');
                    th.textContent = h;
                    th.style.border = '1px solid black';
                    th.style.padding = '0.5em';
                    th.style.background = '#f9f9f9';
                    headRow.appendChild(th);
                });
                thead.appendChild(headRow);
                detailedTable.appendChild(thead);

                const tbody = document.createElement('tbody');
                result.evaluations.forEach(row => {
                    const tr = document.createElement('tr');
                    const cells = [
                        row.category || '',
                        row.question || '',
                        row.score !== undefined ? row.score : '',
                        row.answer || ''
                    ];
                    cells.forEach(cell => {
                        const td = document.createElement('td');
                        td.textContent = cell;
                        td.style.border = '1px solid black';
                        td.style.padding = '0.5em';
                        tr.appendChild(td);
                    });
                    tbody.appendChild(tr);
                });
                detailedTable.appendChild(tbody);

                summaryTableDiv.appendChild(detailedTable);
            }
        });
    </script>
</body>
</html>
